<!-- eMensageriaPro - Sistema de Gerenciamento de Eventos<www.emensageria.com.br>Copyright (C) 2018 Marcelo Medeiros de Vasconcellos This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program. If not, see<https://www.gnu.org/licenses/>. Este programa é distribuído na esperança de que seja útil, mas SEM QUALQUER GARANTIA; sem mesmo a garantia implícita de COMERCIABILIDADE OU ADEQUAÇÃO A UM DETERMINADO FIM. Veja o Licença Pública Geral GNU Affero para mais detalhes. Este programa é software livre: você pode redistribuí-lo e / ou modificar sob os termos da licença GNU Affero General Public License como publicado pela Free Software Foundation, seja versão 3 do Licença, ou (a seu critério) qualquer versão posterior. Você deveria ter recebido uma cópia da Licença Pública Geral GNU Affero junto com este programa. Se não, veja<https://www.gnu.org/licenses/>.-->
{% extends 'base.html' %}{% load templatetags %}{% block content %}{% if not for_print %}
    <meta http-equiv="refresh" content="10">
    <section class="content-header">
        <h1>Importações
            <small>Mapa de Processamento</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i>Home</a></li>
            <li><a href="#">Mapa de Processamento</a></li>
            <li class="active">Importações</li>
        </ol>
    </section>
    <section class="content">{% if messages %}
        <div class="row">
            <div class="pad margin no-print">{% for message in messages %}
                <div class="alert alert-{{ message.tags }}"
                     style="margin-bottom: 0!important;">{{ message }}</div>{% endfor %}</div>
        </div>{% endif %}
        <div class="row">
            <div class="col-xs-12">
                <div class="nav-tabs-custom">
                    <ul class="nav nav-tabs">
                        <li {% if tab == 'master' %}class="active"{% endif %}><a
                                href="{% url 'mapa_importacoes' tab='master' %}">Importação</a>
                        </li>
                        <li {% if tab == 'erros' %}class="active"{% endif %}><a
                                href="{% url 'mapa_importacoes' tab='erros' %}">Erros</a>
                        </li>
                        <li {% if tab == 'processados' %}class="active"{% endif %}><a
                                href="{% url 'mapa_importacoes' tab='processados' %}">Processados</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4 col-xs-6"><!-- small box -->
                <div class="small-box bg-aqua">
                    <div class="inner"><h3>{{ quant_cadastrados }}0</h3>
                        <p><strong>Eventos aguardando importação</strong><br>Aguardando validação</p></div>
                    <div class="icon"><i class="fa fa-edit"></i></div>
                    <a href="{% url 'mapa_importacoes' tab='master' %}" class="small-box-footer">Visualizar<i class="fa fa-eye"></i></a></div>
            </div><!-- ./col -->
            <div class="col-lg-4 col-xs-6"><!-- small box -->
                <div class="small-box bg-orange">
                    <div class="inner"><h3>{{ quant_importados }}0</h3>
                        <p><strong>Eventos com erros na importação</strong><br>Aguardando validação</p></div>
                    <div class="icon"><i class="fa fa-check"></i></div>
                    <a href="{% url 'mapa_importacoes' tab='erros' %}" class="small-box-footer">Visualizar<i class="fa fa-eye"></i></a></div>
            </div><!-- ./col -->
            <div class="col-lg-4 col-xs-6"><!-- small box -->
                <div class="small-box bg-yellow">
                    <div class="inner"><h3>{{ quant_validados }}0</h3>
                        <p><strong>Eventos importados</strong><br>Aguardando envio</p></div>
                    <div class="icon"><i class="fa fa-cloud-upload"></i></div>
                    <a href="{% url 'mapa_importacoes' tab='processados' %}" class="small-box-footer">Visualizar<i class="fa fa-eye"></i></a></div>
            </div><!-- ./col --></div>{% if tab == 'master' %}
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary">
                        <div class="box-header with-border"><h3 class="box-title">Aguardando importação</h3></div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th>Nome do Arquivo</th>
                                    <th>Evento</th>
                                    <th>Versão</th>
                                    <th>Identidade do evento</th>
                                    <th>Status</th>
                                    <th>Data/Hora de Importação</th>
                                </tr>
                                </thead>
                                <tbody>{% for a in lista_aguardando %}
                                    <tr>
                                        <td>{{ a.arquivo }}</td>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.versao }}</td>
                                        <td>{{ a.identidade_evento }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                        <td>{{ a.data_hora }}</td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>{% endif %}{% if tab == 'erros' %}<!-- erros_validacao -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary">
                        <div class="box-header with-border"><h3 class="box-title">Erros</h3></div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th>Nome do Arquivo</th>
                                    <th>Evento</th>
                                    <th>Versão</th>
                                    <th>Identidade do evento</th>
                                    <th>Status</th>
                                    <th>Data/Hora de Importação</th>
                                </tr>
                                </thead>
                                <tbody>{% for a in lista_erros %}
                                    <tr>
                                        <td>{{ a.arquivo }}</td>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.versao }}</td>
                                        <td>{{ a.identidade_evento }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                        <td>{{ a.data_hora }}</td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>{% endif %}{% if tab == 'processados' %}<!-- erros_validacao -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary">
                        <div class="box-header with-border"><h3 class="box-title">Processados</h3></div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th>Nome do Arquivo</th>
                                    <th>Evento</th>
                                    <th>Versão</th>
                                    <th>Identidade do evento</th>
                                    <th>Status</th>
                                    <th>Data/Hora de Importação</th>
                                </tr>
                                </thead>
                                <tbody>{% for a in lista_processados %}
                                    <tr>
                                        <td>{{ a.arquivo }}</td>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.versao }}</td>
                                        <td>{{ a.identidade_evento }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                        <td>{{ a.data_hora }}</td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>{% endif %}</section>
    <script>$(document).ready(function () {
        $('#btnVisualizar').click(function () {
            var formAction = '{% url 'mapa_importacoes' tab='master' %}';
            $('#FormRelatorio').attr('action', formAction);
            $('#FormRelatorio').attr('target', '_self');
            $('#FormRelatorio').submit();
        });
        $('#btnImprimir').click(function () {
            var formAction = '{% url 'mapa_importacoes' tab='master' %}';
            $('#FormRelatorio').attr('action', formAction);
            $('#FormRelatorio').attr('target', '_blank');
            $('#FormRelatorio').submit();
        });
    });</script>{% else %}
    <section class="invoice">
        <div class="row">
            <div class="col-xs-12">
                <h2 class="page-header">Mapa de Processamento
                    <small class="pull-right">Usuário: {{ usuario.nome }}<br>Data: {{ data }}</small>
                </h2>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 table-responsive">{% include 'tables/mapa_processamento.html' %}</div>
        </div>
    </section>{% endif %} {% endblock content %}