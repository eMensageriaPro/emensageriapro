<!-- eMensageriaPro - Sistema de Gerenciamento de Eventos<www.emensageria.com.br>Copyright (C) 2018 Marcelo Medeiros de Vasconcellos This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program. If not, see<https://www.gnu.org/licenses/>. Este programa é distribuído na esperança de que seja útil, mas SEM QUALQUER GARANTIA; sem mesmo a garantia implícita de COMERCIABILIDADE OU ADEQUAÇÃO A UM DETERMINADO FIM. Veja o Licença Pública Geral GNU Affero para mais detalhes. Este programa é software livre: você pode redistribuí-lo e / ou modificar sob os termos da licença GNU Affero General Public License como publicado pela Free Software Foundation, seja versão 3 do Licença, ou (a seu critério) qualquer versão posterior. Você deveria ter recebido uma cópia da Licença Pública Geral GNU Affero junto com este programa. Se não, veja<https://www.gnu.org/licenses/>.-->
{% extends 'base.html' %}{% load templatetags %}{% block content %}{% if not for_print %}
    <meta http-equiv="refresh" content="10">
    <section class="content-header">
        <h1>eSocial
            <small>Mapa de Processamento</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i>Home</a></li>
            <li><a href="#">Mapa de Processamento</a></li>
            <li class="active">eSocial</li>
        </ol>
    </section>
    <section class="content">{% if messages %}
        <div class="row">
            <div class="pad margin no-print">{% for message in messages %}
                <div class="alert alert-{{ message.tags }}"
                     style="margin-bottom: 0!important;">{{ message }}</div>{% endfor %}</div>
        </div>{% endif %}
        <div class="row">
            <div class="col-xs-12">
                <div class="nav-tabs-custom">
                    <ul class="nav nav-tabs">
                        <li {% if not tab %}class="active"{% endif %}><a
                                href="{% url 'mapa_esocial' hash='{}'|json_tab:''|json_id:0|json_print:0|base64_encode_me %}">Visão
                            Geral</a></li>
                        <li {% if tab == 'erros' %}class="active"{% endif %}><a
                                href="{% url 'mapa_esocial' hash='{}'|json_tab:'erros'|json_id:0|json_print:0|base64_encode_me %}">Erros</a>
                        </li>
                        <li {% if tab == 'enviados' %}class="active"{% endif %}><a
                                href="{% url 'mapa_esocial' hash='{}'|json_tab:'enviados'|json_id:0|json_print:0|base64_encode_me %}">Enviados</a>
                        </li>
                        <li {% if tab == 'processados' %}class="active"{% endif %}><a
                                href="{% url 'mapa_esocial' hash='{}'|json_tab:'processados'|json_id:0|json_print:0|base64_encode_me %}">Processados</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-2 col-xs-6"><!-- small box -->
                <div class="small-box bg-aqua">
                    <div class="inner"><h3>{{ quant_cadastrados }}</h3>
                        <p><strong>Eventos cadastrados</strong><br>Aguardando validação</p></div>
                    <div class="icon"><i class="fa fa-edit"></i></div>
                    <a href="{% url 'mapa_esocial' hash='{}'|json_tab:''|json_id:0|json_print:0|base64_encode_me %}"
                       class="small-box-footer">Visualizar<i class="fa fa-eye"></i></a></div>
            </div><!-- ./col -->
            <div class="col-lg-2 col-xs-6"><!-- small box -->
                <div class="small-box bg-orange">
                    <div class="inner"><h3>{{ quant_importados }}</h3>
                        <p><strong>Eventos importados</strong><br>Aguardando validação</p></div>
                    <div class="icon"><i class="fa fa-check"></i></div>
                    <a href="{% url 'esocial_validar' hash='{}'|json_tab:''|json_id:0|json_print:0|base64_encode_me %}"
                       class="small-box-footer">Validar<i class="fa fa-gear"></i></a></div>
            </div><!-- ./col -->
            <div class="col-lg-2 col-xs-6"><!-- small box -->
                <div class="small-box bg-yellow">
                    <div class="inner"><h3>{{ quant_validados }}</h3>
                        <p><strong>Eventos validados</strong><br>Aguardando envio</p></div>
                    <div class="icon"><i class="fa fa-cloud-upload"></i></div>
                    <a href="{% url 'esocial_enviar' hash='{}'|json_tab:''|json_id:0|json_print:0|base64_encode_me %}"
                       class="small-box-footer">Enviar<i class="fa fa-gear"></i></a></div>
            </div><!-- ./col -->
            <div class="col-lg-2 col-xs-6"><!-- small box -->
                <div class="small-box bg-red">
                    <div class="inner"><h3>{{ quant_erros }}</h3>
                        <p><strong>Eventos com erros</strong><br>Aguardando correção</p></div>
                    <div class="icon"><i class="fa fa-close"></i></div>
                    <a href="{% url 'mapa_esocial' hash='{}'|json_tab:'erros'|json_id:0|json_print:0|base64_encode_me %}"
                       class="small-box-footer">Visualizar<i class="fa fa-eye"></i></a></div>
            </div>
            <div class="col-lg-2 col-xs-6"><!-- small box -->
                <div class="small-box bg-green">
                    <div class="inner"><h3>{{ quant_enviados }}</h3>
                        <p><strong>Eventos enviados</strong><br>Aguardando consulta</p></div>
                    <div class="icon"><i class="fa fa-clock-o"></i></div>
                    <a href="{% url 'esocial_consultar' hash='{}'|json_tab:''|json_id:0|json_print:0|base64_encode_me %}"
                       class="small-box-footer">Consultar<i class="fa fa-gear"></i></a></div>
            </div>
            <div class="col-lg-2 col-xs-6"><!-- small box -->
                <div class="small-box bg-primary">
                    <div class="inner"><h3>{{ quant_processados }}</h3>
                        <p><strong>Eventos processados</strong><br>Imprima o recibo</p></div>
                    <div class="icon"><i class="fa fa-check"></i></div>
                    <a href="{% url 'mapa_esocial' hash='{}'|json_tab:'processados'|json_id:0|json_print:0|base64_encode_me %}"
                       class="small-box-footer">Visualizar<i class="fa fa-eye"></i></a></div>
            </div><!-- ./col -->
        </div>
        {% if not tab %}
            <div class="row">
                <div class="col-md-12">
                    <div class="box box-success">
                        <div class="box-header with-border"><h3 class="box-title">Validados</h3>(Listagem de eventos com
                            status: Validado, Aguardando Precedência e Aguardando Envio)
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th width="300px">Evento</th>
                                    <th>Identidade</th>
                                    <th>Status</th>
                                </tr>
                                </thead>
                                <tbody>{% for a in esocial_validados %}
                                    <tr>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.identidade }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="box box-primary">
                        <div class="box-header with-border"><h3 class="box-title">Importados</h3>(Listagem de eventos
                            com status: Importado)
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th width="300px">Evento</th>
                                    <th>Identidade</th>
                                    <th>Status</th>{% if not for_print %}
                                    <th width="80px">Ações</th>{% endif %}</tr>
                                </thead>
                                <tbody>{% for a in esocial_importados %}
                                    <tr>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.identidade }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                        <td>
                                            <div>
                                                <a href="/esocial/{{ a.tabela|underline_to_hyphen }}/validar-evento/{{ '{}'|json_id:a.id|json_print:0|base64_encode_me }}/">
                                                    <button class="btn btn-success"><i
                                                            class="fa fa-fw fa-thumbs-o-up"></i>Validar
                                                    </button>
                                                </a></div>
                                        </td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="box box-primary">
                        <div class="box-header with-border"><h3 class="box-title">Cadastrados</h3>(Listagem de eventos
                            com status: Cadastrado, Duplicado, Gerado ou Assinado)
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th width="300px">Evento</th>
                                    <th>Identidade</th>
                                    <th>Status</th>{% if not for_print %}
                                    <th width="80px">Ações</th>{% endif %}</tr>
                                </thead>
                                <tbody>{% for a in esocial_cadastrados %}
                                    <tr>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.identidade }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                        <td>
                                            <div>
                                                <a href="/esocial/{{ a.tabela|underline_to_hyphen }}/validar-evento/{{ '{}'|json_id:a.id|json_print:0|base64_encode_me }}/">
                                                    <button class="btn btn-success"><i
                                                            class="fa fa-fw fa-thumbs-o-up"></i>Validar
                                                    </button>
                                                </a></div>
                                        </td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>{% endif %}{% if tab == 'erros' %}<!-- erros_validacao -->
            <div class="row">
                <div class="col-md-12">
                    <div class="box box-warning">
                        <div class="box-header with-border"><h3 class="box-title">Erros de validação</h3>(Listagem de
                            eventos com status: Erro na Validação)
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th width="300px">Evento</th>
                                    <th>Identidade</th>
                                    <th>Status</th>{% if not for_print %}
                                    <th width="80px">Ações</th>{% endif %}</tr>
                                </thead>
                                <tbody>{% for a in esocial_erros_validacao %}
                                    <tr>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.identidade }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                        <td>
                                            <div>
                                                <a href="{% url a.tabela_salvar hash='{}'|json_id:a.id|json_print:0|base64_encode_me %}">
                                                    <button class="btn btn-warning"><i class="fa fa-fw fa-edit"></i>Corrigir
                                                    </button>
                                                </a></div>
                                        </td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="box box-danger">
                        <div class="box-header with-border"><h3 class="box-title">Enviados com erro (Listagem de eventos
                            com status: Erro no envio)</h3></div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th width="300px">Evento</th>
                                    <th>Identidade</th>
                                    <th>Status</th>{% if not for_print %}
                                    <th width="80px">Ações</th>{% endif %}</tr>
                                </thead>
                                <tbody>{% for a in esocial_erros_envio %}
                                    <tr>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.identidade }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                        <td>
                                            <div>
                                                <a href="{% url a.tabela_salvar hash='{}'|json_id:a.id|json_print:0|base64_encode_me %}">
                                                    <button class="btn btn-danger"><i class="fa fa-fw fa-check"></i>Corrigir
                                                    </button>
                                                </a></div>
                                        </td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>{% endif %}{% if tab == 'enviados' %}<!-- erros_validacao -->
            <div class="row">
                <div class="col-md-12">
                    <div class="box box-success">
                        <div class="box-header with-border"><h3 class="box-title">Enviados</h3>(Listagem de eventos com
                            status: Enviado)
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th width="300px">Evento</th>
                                    <th>Identidade</th>
                                    <th>Status</th>
                                </tr>
                                </thead>
                                <tbody>{% for a in esocial_enviados %}
                                    <tr>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.identidade }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>{% endif %}{% if tab == 'processados' %}<!-- erros_validacao -->
            <div class="row">
                <div class="col-md-12">
                    <div class="box box-success">
                        <div class="box-header with-border"><h3 class="box-title">Processados</h3>(Listagem de eventos
                            com status: Processado)
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th width="300px">Evento</th>
                                    <th>Identidade</th>
                                    <th>Status</th>
                                    <th width="300px">Recibo</th>
                                </tr>
                                </thead>
                                <tbody>{% for a in esocial_processados %}
                                    <tr>
                                        <td>{{ a.evento }}</td>
                                        <td>{{ a.identidade }}</td>
                                        <td>{{ a.get_status_display }}</td>
                                        <td>
                                            <div>
                                                <a href="/esocial/{{ a.tabela|underline_to_hyphen }}/recibo/{{ '{}'|json_id:a.id|json_print:0|base64_encode_me }}/PDF/"><span
                                                        class="btn btn-primary" title="Imprimir Recibo"><i
                                                        class="fa fa-fw fa-print"></i></span></a></div>
                                        </td>
                                    </tr>{% endfor %}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>{% endif %}</section>
    <script>$(document).ready(function () {
        $('#btnVisualizar').click(function () {
            var formAction = '{% url 'mapa_esocial' hash='{}'|json_return_page:'mapa_esocial'|json_id:0|json_print:0|base64_encode_me %}';
            $('#FormRelatorio').attr('action', formAction);
            $('#FormRelatorio').attr('target', '_self');
            $('#FormRelatorio').submit();
        });
        $('#btnImprimir').click(function () {
            var formAction = '{% url 'mapa_esocial' hash='{}'|json_return_page:'mapa_esocial'|json_id:0|json_print:1|base64_encode_me %}';
            $('#FormRelatorio').attr('action', formAction);
            $('#FormRelatorio').attr('target', '_blank');
            $('#FormRelatorio').submit();
        });
    });</script>{% else %}
    <section class="invoice">
        <div class="row">
            <div class="col-xs-12">
                <h2 class="page-header">Mapa de Processamento
                    <small class="pull-right">Usuário: {{ usuario.nome }}<br>Data: {{ data }}</small>
                </h2>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 table-responsive">{% include 'tables/mapa_processamento.html' %}</div>
        </div>
    </section>{% endif %} {% endblock content %}